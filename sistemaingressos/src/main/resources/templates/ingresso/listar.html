<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layoutpadrao}" lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <title>ShowGo | Lista de Ingressos</title>
</head>

<body>
  <main layout:fragment="main" class="flex-1 ml-64 p-4 md:p-20 mt-10">
    <div class="border border-yellow-500 p-6 md:p-10 shadow-lg rounded-lg bg-white">

            <!-- Cabeçalho -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
        <h1 class="text-2xl md:text-3xl font-bold">Ingressos</h1>
      </div>
      <!-- Formulário de filtros -->
      <form th:action="@{/ingressos}" th:object="${filtro}" method="get"
        class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">

        <input th:field="*{id}" placeholder="ID" class="p-2 border rounded" />

        <input th:field="*{eventoId}" placeholder="ID Evento" class="p-2 border rounded" />

        <input th:field="*{eventoNome}" placeholder="Nome Evento" class="p-2 border rounded" />

        <!-- único campo de data -->
        <input th:field="*{data}" type="date" class="p-2 border rounded" />

        <input th:field="*{local}" placeholder="Local" class="p-2 border rounded" />

        <input th:field="*{tipo}" placeholder="Tipo" class="p-2 border rounded" />

        <!-- único campo de preço -->
        <input th:field="*{preco}" type="number" step="0.01" placeholder="Preço" class="p-2 border rounded" />

        <select th:field="*{status}" class="p-2 border rounded">
          <option value="">Todos os Status</option>
          <option th:each="s : ${T(br.com.sistemaingressos.model.StatusIngresso).values()}" th:value="${s}"
            th:text="${s}"></option>
        </select>

        <!-- Última linha do formulário de filtros -->
        <div class="col-span-1 md:col-span-4 flex gap-4">
          <!-- Botão de aplicar filtros -->
          <button type="submit" class="flex-1 bg-yellow-500 text-black font-semibold
                 px-4 py-2 rounded-lg hover:bg-yellow-400 transition">
            Aplicar Filtros
          </button>

          <!-- Link para anunciar ingresso -->
          <a th:href="@{/ingressos/novo}" class="flex-1 bg-yellow-500 text-black font-semibold
                 px-4 py-2 rounded-lg hover:bg-yellow-400 transition text-center">
            Anunciar Ingresso
          </a>
        </div>

      </form>


      <!-- Tabela -->
      <div class="overflow-x-auto w-full mb-6">
        <table class="min-w-full text-left border border-yellow-500 rounded overflow-hidden shadow">
          <thead class="bg-yellow-500 text-black text-sm uppercase">
            <tr>
              <th class="px-4 py-3">
                <a th:href="@{|/ingressos?sortField=id&sortDir=${reverseDir}|}">
                  ID <span th:if="${sortField=='id'}" th:text="${sortDir=='asc'?'↑':'↓'}"></span>
                </a>
              </th>
              <th class="px-4 py-3">
                <a th:href="@{|/ingressos?sortField=evento.nome&sortDir=${reverseDir}|}">
                  Evento <span th:if="${sortField=='evento.nome'}" th:text="${sortDir=='asc'?'↑':'↓'}"></span>
                </a>
              </th>
              <th class="px-4 py-3">
                <a th:href="@{|/ingressos?sortField=data&sortDir=${reverseDir}|}">
                  Data <span th:if="${sortField=='data'}" th:text="${sortDir=='asc'?'↑':'↓'}"></span>
                </a>
              </th>
              <th class="px-4 py-3">Local</th>
              <th class="px-4 py-3">Tipo</th>
              <th class="px-4 py-3">
                <a th:href="@{|/ingressos?sortField=preco&sortDir=${reverseDir}|}">
                  Preço <span th:if="${sortField=='preco'}" th:text="${sortDir=='asc'?'↑':'↓'}"></span>
                </a>
              </th>
              <th class="px-4 py-3">Status</th>
              <th class="px-4 py-3">Ações</th>
            </tr>
          </thead>
          <tbody th:if="${pagina.content.size() > 0}">
            <tr th:each="ingresso : ${pagina.content}" class="border-t border-yellow-500 hover:bg-black/10 transition">
              <td class="px-4 py-3" th:text="${ingresso.id}">1</td>
              <td class="px-4 py-3" th:text="${ingresso.evento.nome}">Show</td>
              <td class="px-4 py-3" th:text="${#temporals.format(ingresso.data,'dd/MM/yyyy')}">01/07/2025</td>
              <td class="px-4 py-3" th:text="${ingresso.local}">Local</td>
              <td class="px-4 py-3" th:text="${ingresso.tipo}">VIP</td>
              <td class="px-4 py-3" th:text="${#numbers.formatDecimal(ingresso.preco,2,'COMMA',2,'POINT')}">100,00</td>
              <td class="px-4 py-3" th:text="${ingresso.status}">DISPONIVEL</td>
              <td class="px-4 py-3 space-x-3 whitespace-nowrap">
                <div th:if="${ingresso.status.name()=='DISPONIVEL'}" class="inline-flex items-center space-x-2">
                  <!-- Editar / Excluir (apenas ADMIN, se você já tiver sec:authorize aí) -->
                  <a th:href="@{'/ingressos/editar/' + ${ingresso.id}}"
                    class="text-yellow-400 hover:underline">Editar</a>
                  <a th:href="@{'/ingressos/excluir/' + ${ingresso.id}}" class="text-red-500 hover:underline"
                    onclick="return confirm('Tem certeza que deseja excluir este ingresso?');">Excluir</a>

                  <!-- Comprar (qualquer usuário autenticado) -->
                  <form th:action="@{/transacoes/comprar/{id}(id=${ingresso.id})}" method="post"
                    style="display:inline;">
                    <button type="submit"
                      class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 transition text-sm">
                      Comprar
                    </button>
                  </form>
                </div>
              </td>

            </tr>
          </tbody>
          <tbody th:if="${pagina.content.isEmpty()}">
            <tr>
              <td colspan="8" class="px-4 py-6 text-center text-gray-300">Nenhum ingresso encontrado.</td>
            </tr>
          </tbody>
        </table>
      </div>

     <!-- Paginação com caixas uniformes -->
<nav class="flex justify-center mt-4">
  <ul class="inline-flex items-center space-x-1">

    <!-- First -->
    <li th:if="${pagina.hasPrevious()}">
      <a th:href="${pagina.buildPageUrl(0)}"
         class="w-8 h-8 flex items-center justify-center border border-yellow-500 hover:bg-yellow-500 hover:text-white transition">
        «
      </a>
    </li>

    <!-- Prev -->
    <li th:if="${pagina.hasPrevious()}">
      <a th:href="${pagina.buildPageUrl(pagina.number - 1)}"
         class="w-8 h-8 flex items-center justify-center border border-yellow-500 hover:bg-yellow-500 hover:text-white transition">
        ‹
      </a>
    </li>

    <!-- Números de página -->
    <li th:each="i : ${pagina.pageNumbers}">
      <a th:href="${pagina.buildPageUrl(i)}"
         th:text="${i + 1}"
         th:classappend="${i == pagina.number} ? ' bg-yellow-500 text-white' : ''"
         class="w-8 h-8 flex items-center justify-center border border-yellow-500 hover:bg-yellow-500 hover:text-white transition">
      </a>
    </li>

    <!-- Next -->
    <li th:if="${pagina.hasNext()}">
      <a th:href="${pagina.buildPageUrl(pagina.number + 1)}"
         class="w-8 h-8 flex items-center justify-center border border-yellow-500 hover:bg-yellow-500 hover:text-white transition">
        ›
      </a>
    </li>

    <!-- Last -->
    <li th:if="${pagina.hasNext()}">
      <a th:href="${pagina.buildPageUrl(pagina.totalPages - 1)}"
         class="w-8 h-8 flex items-center justify-center border border-yellow-500 hover:bg-yellow-500 hover:text-white transition">
        »
      </a>
    </li>

  </ul>
</nav>



    </div>
  </main>
</body>

</html>